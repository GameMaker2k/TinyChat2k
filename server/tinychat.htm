<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" style="width: 100%; height: 100%;">
 <head>
  <title> new document </title>
  <meta name="generator" content="editplus" />
  <meta name="author" content="" />
  <meta name="keywords" content="" />
  <meta name="description" content="" />
<script type="text/javascript" src="./javascript/jquery.js"></script>
<script type="text/javascript" src="./javascript/base64_decode.js"></script>
<script type="text/javascript" src="./javascript/hash/sha512.js"></script>
<script type="text/javascript">
<!--
userlogin = false;
document.title = "TinyChat2k - Login";
function getid(id) {
var itm;
itm = document.getElementById(id);
return itm; }

function toggletag(id) {
var itm;
itm = document.getElementById(id);
if (itm.style.display == "none") {
itm.style.display = ""; }
else {
itm.style.display = "none"; } }

function getNewMessages(gotoroom) {
    var result="";
    $.ajax({
      url:"./api.php?act=view&room=tinychat",
      type: "get",
      async: false,  
      success:function(data) {
         result = data; 
      }
   });
   return result;
}

function sendMessages(message, gotoroom) {
    var result="";
    $.ajax({
      url:"./api.php?act==message&room="+encodeURIComponent(gotoroom),
      type: "post",
      data: "message="+encodeURIComponent(message),
      async: false,  
      success:function(data) {
         result = data; 
      }
   });
   return result;
}

function getSignUp(username, userpass, gotoroom) {
    var result="";
    $.ajax({
      url:"./api.php?act=login&room="+encodeURIComponent(gotoroom),
      type: "post",
      data: "username="+encodeURIComponent(username)+"&userpass="+encodeURIComponent(userpass),
      async: false,  
      success:function(data) {
         result = data; 
      }
   });
   return result;
}

function getLogIn(username, userpass, gotoroom) {
    var result="";
    $.ajax({
      url:"./api.php?act=login&room="+encodeURIComponent(gotoroom),
      type: "post",
      data: "username="+encodeURIComponent(username)+"&userpass="+encodeURIComponent(CryptoJS.SHA512(userpass)),
      async: false,  
      success:function(data) {
         result = data; 
      }
   });
   if(result=="{warning:newuser};") { result = getSignUp(username, userpass, gotoroom); }
   if(result=="{error:loginuser};") { return false; }
   if(result=="{success:loginuser};") { return true; }
   return false;
}

function showNewMessages(gotoroom) {
	newmessage = null;
	while(true==true) {
		newmessage = getNewMessages(gotoroom);
		if(newmessage!="") { 
			newmessage_part = newmessage.split("\n");
			chatsize = newmessage_part.length - 1;
			chati = 0;
			getmessage_part = null;
			while(chati<chatsize) {
				getmessage_part = newmessage_part[chati].match(/([0-9]+)\, ([0-9]+)\, \"([0-9a-z]+)\"\, \"(.*)\";/); 
				$('#chattext').append("<span style='color: green;'>"+getmessage_part[3]+":<\/span> "+base64_decode(getmessage_part[4])+"<br />\n");
				++chati; 
			}
		} 
	}
}
//$("#messages").animate({scrollTop: $("#messages").height()}, 300);
//-->
</script>
 </head>

 <body style="width: 100%; height: 100%; color: white; background: black;">
<div id="logindiv" style="width: 100%; height: 100%;"><form method="post" id="loginform" name="loginform" action="#" onsubmit="if(getLogIn(document.loginform.username.value, document.loginform.userpass.value, document.loginform.gotoroom.value)==true) { document.title = 'TinyChat2k - '+document.loginform.gotoroom.value; toggletag('chatdiv'); userlogin = true; toggletag('logindiv'); } if(userlogin==true) { showNewMessages(document.loginform.gotoroom.value); } return false;">
<label for="username">User Name: </label>
<input style="border: black; color: skyblue; background: black;" type="text" name="username" id="username" /><br />
<label for="userpass">Password: </label>
<input style="border: black; color: skyblue; background: black;" type="password" name="userpass" id="userpass" /><br />
<label for="gotoroom">Chat Room: </label>
<input style="border: black; color: skyblue; background: black;" type="text" name="gotoroom" id="gotoroom" /><br />
<input style="border: black; color: skyblue; background: black;" value="Login" type="submit" />
</form></div>

<div id="chatdiv" style="display: none; width: 100%; height: 100%; vertical-align: middle;">
<div id="chattext" style="color: white; background: black; width: 100%; height: 95%; overflow-x: hidden; overflow-y: scroll;"></div>
</div>


 </body>
</html>
